<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metapsyTools">
<title>metapsyTools • metapsyTools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Fira%20Sans-0.4.1/font.css" rel="stylesheet">
<link href="../deps/_Fira%20Code-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="metapsyTools">
<meta property="og:description" content="metapsyTools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script src="extra_script_header.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metapsyTools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/metapsyTools.html">Get Started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-documentation">Documentation</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-documentation">
    <a class="dropdown-item" href="../reference/index.html">Function Reference</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/web/installation.html">Installation Guide</a>
    <a class="dropdown-item" href="../articles/web/look_inside.html">A Look Inside</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metapsy-project/metapsyTools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>metapsyTools</h1>
                        <h4 data-toc-skip class="author">Mathias Harrer,
Paula Kuper &amp; Antonia Sprenger</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metapsy-project/metapsyTools/blob/HEAD/vignettes/metapsyTools.Rmd" class="external-link"><code>vignettes/metapsyTools.Rmd</code></a></small>
      <div class="d-none name"><code>metapsyTools.Rmd</code></div>
    </div>

    
    
<p><br></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr>
<p>The <code>metapsyTools</code> package facilitates the calculation of
effect sizes (i.e. Hedges’ <span class="math inline">\(g\)</span>) and
meta-analyses using the <a href="https://www.metapsy.org" class="external-link"><strong>Metapsy</strong></a> databases
(or databases adhering to the same format).</p>
<p>The package consists of <strong>two modules</strong>:</p>
<ol style="list-style-type: decimal">
<li>A module to check the data format and calculate effect sizes for all
possible study comparisons (<strong>preparation</strong> module);</li>
<li>A module to select relevant comparisons for a specific
meta-analysis, calculate the results (including subgroup,
meta-regression, and publication bias analyses), and generate tables
(<strong>analysis</strong> module).</li>
</ol>
<p>The idea is to use the two modules in different contexts. For
example, the <strong>preparation</strong> module can be used every time
the database is updated to gather all information, calculate effect
sizes, and bring the data into a format suitable for further
analyses.</p>
<p>Prepared data sets that follow the <a href="https://docs.metapsy.org/data-preparation/format/" class="external-link">Metapsy data
standard</a> build the basis for the <strong>analysis</strong> module.
Researchers simply have to filter out the comparisons that are relevant
for the investigation, and can then use functions of the package to run
a full meta-analysis, including sensitivity and subgroup analyses.</p>
<p><br></p>
<p><img src="overview.png" width="685"></p>
<div style="border: 1px solid #dee2e6; background-color: #f1f3f5 !important; padding: 10px; border-radius: 3px;">
<p><strong>Important</strong>: The preparation module requires a
familiarity with the general structure of the database, as well as
intermediate-level knowledge of R and the <code>metapsyTools</code>
package itself, in order to diagnose (potential) issues. We advise that
the preparation step (i.e. checking the data format and calculating
effect sizes each time the database is updated) should be conducted by a
person with some proficiency in R &amp; data wrangling. The analysis
module, on the other hand, should be usable by all researchers.</p>
</div>
<p><br></p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="the-preparation-module">The Preparation Module<a class="anchor" aria-label="anchor" href="#the-preparation-module"></a>
</h2>
<hr>
<p>The preparation module in <code>metapsyTools</code> allows to:</p>
<ul>
<li>check if the classes of variables in the imported data set are as
required, using <code>checkDataFormat</code>
</li>
<li>check for formatting conflicts which have to be resolved prior to
any further steps, using <code>checkConflicts</code>
</li>
<li>calculate Hedges’ <span class="math inline">\(g\)</span> and/or risk
ratios (<span class="math inline">\(RR\)</span>) for each comparison,
provided suitable data is available, and generate a data set ready for
meta-analyses, using <code>calculateEffectSizes</code>.</li>
</ul>
<p><br></p>
<div class="section level3">
<h3 id="required-data-structure">Required Data Structure<a class="anchor" aria-label="anchor" href="#required-data-structure"></a>
</h3>
<p>For your own convenience, it is highly advised to
<strong>strictly</strong> follow some data formatting rules prior to
importing a data set for effect size calculations. If all of these rules
are followed closely, it minimizes the risk of receiving error messages,
producing conflicts, etc.</p>
<p>A detailed description of the preferred data structure can be found
in the <a href="https://docs.metapsy.org/data-preparation/format/" class="external-link">Metapsy
documentation</a>.</p>
<p>To use the data preparation module (i.e. calculate effect sizes),
study design (I) and effect size data variables (II) must be included in
the data set.</p>
<p><br></p>
<div class="section level4">
<h4 id="study-design-variables-i">Study Design Variables (I)<a class="anchor" aria-label="anchor" href="#study-design-variables-i"></a>
</h4>
<ul>
<li>
<strong><code>study</code></strong>: The study name, formatted as
“last name of the first author”, “year”
(e.g. <code>"Smith, 2011"</code>).</li>
<li>
<strong><code>condition_arm1</code></strong>: Condition in the first
trial arm. The condition name is standardized to ensure comparability
across trials (e.g. <code>cbt</code> for all trial arms that employed
cognitive-behavioral psychotherapy).</li>
<li>
<strong><code>condition_arm2</code></strong>: Condition in the
second trial arm. The condition name is standardized to ensure
comparability across trials (e.g. <code>wlc</code> for all trial arms
that employed a waitlist control group).</li>
<li>
<strong><code>multi_arm1</code></strong>: In multiarm trials, this
variable provides a “specification” of the type of treatment used in the
first arm. This variable is set to <code>NA</code> (missing) when the
study was not a multiarm trial. For example, if a multiarm trial
employed two types of CBT interventions, face-to-face and
Internet-based, this variable would be set to <code>f2f</code> and
<code>Internet</code>, respectively.</li>
<li>
<strong><code>multi_arm2</code></strong>: In multiarm trials, this
variable provides a “specification” of the type of treatment used in the
second arm. This variable is set to <code>NA</code> (missing) when the
study was not a multiarm trial. For example, if a multiarm trial
employed two types of control groups, waitlist and placebo, this
variable would be set to <code>wl</code> and <code>plac</code>,
respectively.</li>
<li>
<strong><code>outcome_type</code></strong>: This variable encodes
the type of outcome that builds the basis of the comparison,
e.g. <code>response</code>, <code>remission</code> or
<code>deterioration</code>. This is variable is particularly relevant
for dichotomous effect size data, because it indicates what the event
counts refer to. The <code>msd</code> factor level is used for outcomes
expressed in means and standard deviations.</li>
<li>
<strong><code>instrument</code></strong>: This variable describes
the instrument through which the relevant outcome was measured.</li>
<li>
<strong><code>time</code></strong>: The measurement point at which
the outcome was obtained (e.g. <code>post</code> or
<code>follow-up</code>).</li>
<li>
<strong><code>time_weeks</code></strong>: The measurement point at
which the outcome was obtained, in weeks after randomization (set to
<code>NA</code> if this information was not available).</li>
<li>
<strong><code>rating</code></strong>: This variable encodes if the
reported outcome was self-reported (<code>"self-report"</code>) or
clinician-rated (<code>"clinician"</code>).</li>
</ul>
<p><br></p>
</div>
<div class="section level4">
<h4 id="effect-size-data-variables-ii">Effect Size Data Variables (II)<a class="anchor" aria-label="anchor" href="#effect-size-data-variables-ii"></a>
</h4>
<p>Each Metapsy database also contains variables in which the (raw or
pre-calculated) effect size data is stored. In each row, one of the
following variable groups (a) to (d) will be specified, depending on the
type of outcome data reported in the paper. The rest of the variable
groups will contain <code>NA</code> in that row.</p>
<p><br></p>
<p><strong>(a)</strong> Continuous Outcome Data</p>
<ul>
<li>
<strong><code>mean_arm1</code></strong>: Mean of the outcome in the
first arm at the measured time point.</li>
<li>
<strong><code>mean_arm2</code></strong>: Mean of the outcome in the
second arm at the measured time point.</li>
<li>
<strong><code>sd_arm1</code></strong>: Standard deviation of the
outcome in the first arm at the measured time point.</li>
<li>
<strong><code>sd_arm2</code></strong>: Standard deviation of the
outcome in the second arm at the measured time point.</li>
<li>
<strong><code>n_arm1</code></strong>: Sample size in the first trial
arm.</li>
<li>
<strong><code>n_arm2</code></strong>: Sample size in the second
trial arm.</li>
</ul>
<p><br></p>
<p><strong>(b)</strong> Change Score Data</p>
<ul>
<li>
<strong><code>mean_change_arm1</code></strong>: Mean score change
between baseline and the measured time point in the first arm.</li>
<li>
<strong><code>mean_change_arm2</code></strong>: Mean score change
between baseline and the measured time point in the second arm.</li>
<li>
<strong><code>sd_change_arm1</code></strong>: Standard deviation of
the mean change in the first arm.</li>
<li>
<strong><code>sd_change_arm2</code></strong>: Standard deviation of
the mean change in the second arm.</li>
<li>
<strong><code>n_change_arm1</code></strong>: Sample size in the
first trial arm.</li>
<li>
<strong><code>n_change_arm2</code></strong>: Sample size in the
second trial arm.</li>
</ul>
<p><br></p>
<p><strong>(c)</strong> Dichotomous Outcome Data (Response, Remission,
Deterioration, …)</p>
<ul>
<li>
<strong><code>event_arm1</code></strong>: Number of events
(responders, remission, deterioration cases) in the first trial
arm.</li>
<li>
<strong><code>event_arm2</code></strong>: Number of events
(responders, remission, deterioration cases) in the second trial
arm.</li>
<li>
<strong><code>totaln_arm1</code></strong>: Sample size in the first
trial arm.</li>
<li>
<strong><code>totaln_arm2</code></strong>: Sample size in the second
trial arm.</li>
</ul>
<p><br></p>
<p><strong>(d)</strong> Pre-calculated Hedges’ <span class="math inline">\(g\)</span></p>
<ul>
<li>
<strong><code>precalc_g</code></strong>: The pre-calculated value of
Hedges’ <span class="math inline">\(g\)</span> (small-sample bias
corrected standardized mean difference; <a href="https://journals.sagepub.com/doi/10.3102/10769986006002107" class="external-link">Hedges,
1981</a>).</li>
<li>
<strong><code>precalc_g_se</code></strong>: Standard error of <span class="math inline">\(g\)</span>, viz. <span class="math inline">\(\sqrt{V_g}\)</span>.</li>
</ul>
<p><br></p>
<p><strong>(d)</strong> Pre-calculated log-risk ratio</p>
<ul>
<li>
<strong><code>precalc_log_rr</code></strong>: The pre-calculated
value of the log-risk ratio <span class="math inline">\(\log_{e}\text{RR}\)</span>, comparing events in
the first arm to events in the second arm.</li>
<li>
<strong><code>precalc_log_rr_se</code></strong>: The standard error
of the log-risk ratio <span class="math inline">\(\log_{e}\text{RR}\)</span>, comparing events in
the first arm to events in the second arm.</li>
</ul>
<p><br></p>
</div>
<div class="section level4">
<h4 id="additional-considerations">Additional Considerations<a class="anchor" aria-label="anchor" href="#additional-considerations"></a>
</h4>
<p>Metapsy databases also contain additional variables. These are used,
for example, to collect subject-specific information that is not
relevant for all indications. Nevertheless, there are several formatting
rules that all variables/columns follow:</p>
<ul>
<li>All variable names are in <a href="https://en.wikipedia.org/wiki/Snake_case?oldformat=true" class="external-link"><code>snake_case</code></a>.</li>
<li>Variable names start with a standard letter (<code>_</code> is not
allowed, <code>.</code> is only allowed for <code>metapsyTools</code>
variables).</li>
<li>Variable names do not contain special characters (like ö, @, è,
ğ).</li>
<li>Semicolons (<code>;</code>) are not used; neither as variable names
nor as cell content.</li>
<li>Character values contain no leading/trailing whitespaces.</li>
<li>Missing values are encoded using <code>NA</code>.</li>
</ul>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="data-format-conflict-check">Data Format &amp; Conflict Check<a class="anchor" aria-label="anchor" href="#data-format-conflict-check"></a>
</h3>
<p>Once the data set has been pre-structured correctly,
<code>metapsyTools</code> allows you to check the required variable
format and control for potential formatting conflicts.</p>
<p>If the formatting rules above are followed, none of the default
behavior of the preparation module has to be changed. At first, one can
run <code>checkDataFormat</code>. As an illustration, we will use the
<code>depressionPsyCtr</code> data frame, which is directly available
after installing <code>metapsyTools</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/metapsy-project/metapsyTools" class="external-link">metapsyTools</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/Replacement-functions.html">data</a></span><span class="op">(</span><span class="st">"depressionPsyCtr"</span><span class="op">)</span>
<span class="va">depressionPsyCtr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkDataFormat.html">checkDataFormat</a></span><span class="op">(</span><span class="va">depressionPsyCtr</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## - [OK] Data set contains all variables in 'must.contain'.</span>
<span class="co">## - [OK] 'study' has desired class character.</span>
<span class="co">## - [OK] 'condition_arm1' has desired class character.</span>
<span class="co">## - [OK] 'condition_arm2' has desired class character.</span>
<span class="co">## - [OK] 'multi_arm1' has desired class character.</span>
<span class="co">## - [OK] 'multi_arm2' has desired class character.</span>
<span class="co">## - [OK] 'outcome_type' has desired class character.</span>
<span class="co">## - [OK] 'instrument' has desired class character.</span>
<span class="co">## - [OK] 'time' has desired class character.</span>
<span class="co">## - [OK] 'time_weeks' has desired class numeric.</span>
<span class="co">## - [OK] 'rating' has desired class character.</span></code></pre>
<p>We see that the function has checked the required variables and their
class. If divergent, the function will also try to
<strong>convert</strong> the variable to the desired format.</p>
<p>You can avoid the prompt asking for the database format if you
specify the <code>data.format</code> argument directly in the
function:</p>
<div style="border: 1px solid #dee2e6; background-color: #f1f3f5 !important; padding: 10px; border-radius: 3px;">
<p><strong>Required variables for unique IDs</strong>: To function
properly, the <code>metapsyTools</code> functions must be able to
generate a <em>unique</em> ID for each comparison. By default, this is
achieved by combining information of the <code>study</code>,
<code>condition_arm1</code>, <code>condition_arm2</code>,
<code>multi_arm1</code>, <code>multi_arm2</code>,
<code>outcome_type</code>, <code>instrument</code>, <code>time</code>,
<code>time_weeks</code>, <code>rating</code> variables. These variables
are included by default in the <code>must.contain</code> argument in the
<code>checkDataFormat</code> function. If all required variables are
detected, an <code>OK</code> message is returned; as is the case in our
example.</p>
</div>
<p>We can also check the data for potential formatting issues, using the
<code>checkConflicts</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depressionPsyCtr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/checkConflicts.html">checkConflicts</a></span><span class="op">(</span><span class="va">depressionPsyCtr</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">## - [OK] No data format conflicts detected.</span></code></pre>
<p>In our case, no data format conflicts were detected. This is because
all the data were pre-structured correctly. If data conflicts exist, the
output looks similar to this:</p>
<pre><code>- [!] Data format conflicts detected!
ID conflicts 
- check if variable(s) study create(s) unique assessment point IDs 
- check if specification uniquely identifies all trial arms in multiarm trials 
--------------------
Abas, 2018
Ammerman, 2013
Andersson, 2005
Arean, 1993
Ayen, 2004
Barrett, 2001
Bedard, 2014
Bowman, 1995
Brown, 1984</code></pre>
<p><br></p>
</div>
<div class="section level3">
<h3 id="effect-size-calculation">Effect Size Calculation<a class="anchor" aria-label="anchor" href="#effect-size-calculation"></a>
</h3>
<p>After the multiarm expansion, the effect size (Hedges’ <span class="math inline">\(g\)</span> or risk ratio) and its variance can be
calculated for all comparisons, using <code>calculateEffectSizes</code>.
When applying <code>calculateEffectSizes</code>, the effect size
functions specified in the <code>funcs</code> argument are applied by
default, which means that effect sizes based on Mean, SD and N, and
binary outcomes can be calculated.</p>
<p>The <code>calculateEffectSizes</code> function adds nine columns to
the data set, all of which start with a dot (<code>.</code>). They are
included so that meta-analysis functions in <code>metapsyTools</code>
can be applied “out of the box”.</p>
<ul>
<li>
<strong><code>.id</code></strong>: Unique identifier for a trial arm
comparison/row.</li>
<li>
<strong><code>.g</code></strong>: Calculated effect size (Hedges’
<span class="math inline">\(g\)</span>).</li>
<li>
<strong><code>.g_se</code></strong>: Standard error of Hedges’ <span class="math inline">\(g\)</span>.</li>
<li>
<strong><code>.log_rr</code></strong>: Calculated effect size (<span class="math inline">\(\log_{e}\text{RR}\)</span>).</li>
<li>
<strong><code>.log_rr_se</code></strong>: Standard error of <span class="math inline">\(\log_{e}\text{RR}\)</span>.</li>
<li>
<strong><code>.event_arm1</code></strong>: Number of events
(e.g. responders) in the first trial arm.</li>
<li>
<strong><code>.event_arm2</code></strong>: Number of events
(e.g. responders) in the second trial arm.</li>
<li>
<strong><code>.totaln_arm1</code></strong>: Total sample size in the
first trial arm.</li>
<li>
<strong><code>.totaln_arm2</code></strong>: Total sample size in the
second trial arm.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateEffectSizes.html">calculateEffectSizes</a></span><span class="op">(</span><span class="va">depressionPsyCtr</span><span class="op">)</span></code></pre></div>
<pre><code>- [OK] Hedges' g calculated successfully.
- [OK] Log-risk ratios calculated successfully.</code></pre>
<p>Please note that the current version of the data set only includes
all unique trial arm <strong>combinations</strong>, not all
<em>unique</em> <strong>comparisons</strong>. Let us a four-arm trial as
an example. Say that this trial included CBT, PST, CAU and a wait-list
condition. While this trial provides 6 unique trial arm combinations,
the number of unique <em>comparisons</em> is higher: <span class="math inline">\(\frac{n!}{(n-k)!} = \frac{4!}{2!} =
12\)</span>.</p>
<p>This is because the sign of the calculated effect size depends on
which treatment serves as the <em>reference</em>. The effect of CBT
vs. PST, for example, depends on which arm serves as the reference group
(i.e. CBT-PST or PST-CBT). Depending on which arm is chosen (and
assuming non-zero mean differences), the calculated effect size
(e.g. Hedges’ <span class="math inline">\(g\)</span>) value will either
be negative (e.g. <span class="math inline">\(g\)</span>=-0.31) or
positive (<span class="math inline">\(g\)</span>=0.31). We see this
visualized in the graph below. There are now two directed arrows for
each comparison (12 in total), and each arrow reads as “is compared
to”:</p>
<center>
<p><img src="graph2.png" width="200"></p>
</center>
<p>To truly calculate all unique <em>comparisons</em>, we have to set
the <code>include.switched.arms</code> argument to <code>TRUE</code>
when running <code>calculateEffectSizes</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculateEffectSizes.html">calculateEffectSizes</a></span><span class="op">(</span><span class="va">depressionPsyCtr</span>,
                             include.switched.arms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The resulting data frame <code>data</code> now includes all effect
sizes that can theoretically be calculated. As a last step, one has to
manually add the effect sizes and standard errors of comparisons for
which <code>calculateEffectSizes</code> returned <code>NA</code>. This
leads to a final data set which can be used with the <strong>analysis
module</strong>, which will be described next.</p>
<div style="border: 1px solid #dee2e6; background-color: #f1f3f5 !important; padding: 10px; border-radius: 3px;">
<p><strong>Should I use <code>include.switched.arms</code>?</strong> It
is not essential to calculate all possible arm comparisons. However,
having all possible comparisons in your data set is convenient, because
all required comparisons pertaining to a particular research question
(e.g. “how effective is PST when CBT is the reference group?”) can
directly be filtered out; there is typically no need for further data
manipulation steps.</p>
</div>
<p><br></p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="the-analysis-module">The Analysis Module<a class="anchor" aria-label="anchor" href="#the-analysis-module"></a>
</h2>
<hr>
<p>The analysis module in <code>metapsyTools</code> allows to run
different kinds of meta-analyses based on the final data set created by
the preparation module. It is designed to also be usable by researchers
who were not directly involved in the preparation step, and is less
demanding in terms of required background knowledge.</p>
<p>Metapsy databases included in <a href="https://data.metapsy.org" class="external-link"><code>metapsyData</code></a> can
directly be used by the analysis module in
<code>metapsyTools</code>.</p>
<p>The analysis module allows, among other things, to:</p>
<ul>
<li>Filter data using strict rules, fuzzy string matching, or by
implementing prioritization rules (<code>filterPoolingData</code> and
<code>filterPriorityRule</code>).</li>
<li>Run conventional (random-effects) meta-analysis models as well as
commonly reported sensitivity analyses
(<code>runMetaAnalysis</code>)</li>
<li>Correct effect estimates for potential publication bias or
small-study effects (<code>correctPublicationBias</code>)</li>
<li>Run subgroup analyses based on the fitted model
(<code>subgroupAnalysis</code>)</li>
<li>Create study information tables
(<code>createStudyTable</code>).</li>
</ul>
<p><br></p>
<div class="section level3">
<h3 id="filtering-relevant-comparisons">Filtering Relevant Comparisons<a class="anchor" aria-label="anchor" href="#filtering-relevant-comparisons"></a>
</h3>
<p>The <code>metapsyTools</code> package contains functions which allow
to flexibly filter out comparisons that are relevant for a particular
meta-analysis.</p>
<p>The <code>filterPoolingData</code> function is the main function for
filtering. We simply have to provide the final data set with calculated
effect sizes (see <a href="#the-preparation-module">The Preparation
Module</a>), as well as one or several filtering criteria pertaining to
our specific research question.</p>
<p>Say that we want to run a meta-analysis of all studies in which CBT
was compared to wait-lists, with the BDI-II at post-test being the
analyzed outcome. We can filter out the relevant comparisons like
this:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/filterPoolingData.html">filterPoolingData</a></span><span class="op">(</span><span class="va">condition_arm1</span> <span class="op">==</span> <span class="st">"cbt"</span>,
                      <span class="va">condition_arm2</span> <span class="op">==</span> <span class="st">"wl"</span>,
                      <span class="va">instrument</span> <span class="op">==</span> <span class="st">"bdi-1"</span>,
                      <span class="va">time</span> <span class="op">==</span> <span class="st">"post"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 7</span></code></pre>
<p>We see that <span class="math inline">\(k\)</span>=7 comparisons
fulfill these criteria. Note, however, that this will only select
comparisons for which <code>condition_arm1</code> was <em>exactly</em>
defined as <code>"cbt"</code>.</p>
<p>It is also possible to filter out all rows that simply
<em>contain</em> a specific search term (<strong>fuzzy
matching</strong>). For example, instead of <code>"cbt"</code>, we might
want to filter out all studies that employed some type of “other”
therapy format. This can be achieved by using the <code>Detect</code>
function within <code>filterPoolingData</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/filterPoolingData.html">filterPoolingData</a></span><span class="op">(</span><span class="fu"><a href="../reference/Detect.html">Detect</a></span><span class="op">(</span><span class="va">condition_arm1</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 9</span></code></pre>
<p>We see that this returns <span class="math inline">\(k\)</span>=9
entries.</p>
<p>We can create even more complex filters. Say that we want to examine
the effect, as measured by the BDI-I at post-test, of CBT, PST, and BAT
compared to <em>either</em> CAU or wait-lists. We can visualize this
with a graph again:</p>
<center>
<p><img src="graph3.png" width="200"></p>
</center>
<p>We can use the OR-Operator <code>|</code> within
<code>filterPoolingData</code> for such filter types. Again, we use the
<code>Detect</code> function to allow for fuzzy matching:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/filterPoolingData.html">filterPoolingData</a></span><span class="op">(</span><span class="fu"><a href="../reference/Detect.html">Detect</a></span><span class="op">(</span><span class="va">condition_arm1</span>, <span class="st">"cbt|pst|bat"</span><span class="op">)</span>,
                    <span class="fu"><a href="../reference/Detect.html">Detect</a></span><span class="op">(</span><span class="va">condition_arm2</span>, <span class="st">"cau|wl"</span><span class="op">)</span>,
                    <span class="va">instrument</span> <span class="op">==</span> <span class="st">"bdi-1"</span>,
                    <span class="va">time</span> <span class="op">==</span> <span class="st">"post"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 11</span></code></pre>
<p><br></p>
<p>Lastly, one can also filter data according to a specified
<strong>priority rule</strong>, using the
<code>filterPriorityRule</code> function. This is particularly helpful
to select instruments. Say, for example, that we ordered certain
instruments based on their known reliability. Now, for each study, we
only want to select the comparison in which the most reliable instrument
was used. It is possible that, for some studies, all used instruments
are relatively unreliable. However, given our priority rule, we can
still extract the comparison with a <em>relatively</em> high
reliability, and discard all the other measurements within one study
that are even less reliable.</p>
<p>Assume that our priority rule for the employed instrument is
<code>"hdrs"</code> (priority 1), <code>"bdi-2"</code> (priority 2),
<code>"phq-9"</code> (priority 3) and <code>"bdi-1"</code> (priority 4).
We can implement the rule like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># First, filter all other relevant characteristics</span>
  <span class="fu"><a href="../reference/filterPoolingData.html">filterPoolingData</a></span><span class="op">(</span><span class="fu"><a href="../reference/Detect.html">Detect</a></span><span class="op">(</span><span class="va">condition_arm1</span>, <span class="st">"cbt|pst|bat"</span><span class="op">)</span>,
                    <span class="fu"><a href="../reference/Detect.html">Detect</a></span><span class="op">(</span><span class="va">condition_arm2</span>, <span class="st">"cau|wl"</span><span class="op">)</span>,
                    <span class="va">time</span> <span class="op">==</span> <span class="st">"post"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Now, implement the priority rule for the outcome instrument</span>
  <span class="fu"><a href="../reference/filterPriorityRule.html">filterPriorityRule</a></span><span class="op">(</span>instrument <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hdrs"</span>, <span class="st">"bdi-2"</span>, 
                                    <span class="st">"phq-9"</span>, <span class="st">"bdi-1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># Show number of entries</span>
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 15</span></code></pre>
<p><br></p>
</div>
<div class="section level3">
<h3 id="pooling-effects">Pooling Effects<a class="anchor" aria-label="anchor" href="#pooling-effects"></a>
</h3>
<p>After all relevant rows have been filtered out, we can start to pool
the effect sizes. The <code>runMetaAnalysis</code> function serves as a
wrapper for several commonly used meta-analytic approaches, and, by
default, applies them all at once to our data:</p>
<ul>
<li>
<code>"overall"</code>. Runs a generic inverse-variance
(random-effects) model. All included effect sizes are treated as
independent.</li>
<li>
<code>"combined"</code>. Pools all effect sizes within one study
before calculating the overall effect. This ensures that all effect
sizes are independent (i.e., unit-of-analysis error &amp;
double-counting is avoided). To combine the effects, one has to assume a
<strong>correlation</strong> of effect sizes within studies, empirical
estimates of which are typically not available. By default,
<code>runMetaAnalysis</code> assumes that <span class="math inline">\(\rho\)</span>=0.5.</li>
<li>
<code>"lowest.highest"</code>. Runs a meta-analysis, but with only
(i) the lowest and (ii) highest effect size within each study
included.</li>
<li>
<code>"outlier"</code>. Runs a meta-analysis without statistical
outliers (i.e. effect sizes for which the confidence interval does not
overlap with the confidence interval of the overall effect).</li>
<li>
<code>"influence"</code>. Runs a meta-analysis without influential
cases (see <code>influence.rma.uni</code> for details).</li>
<li>
<code>"rob"</code>. Runs a meta-analysis with only low-RoB studies
included. By default, only studies with a value <code>&gt; 2</code> in
the <code>rob</code> variable are considered for this analysis.</li>
<li>
<code>"threelevel"</code>. Runs a multilevel (three-level)
meta-analysis model, with effect sizes nested in studies.</li>
<li>
<code>"threelevel.che"</code>. Runs a multilevel (three-level)
“correlated and hierarchical effects” (CHE) meta-analysis model. In this
model, effect sizes are nested in studies, and effects within studies
are assumed to be correlated. This will typically be a plausible
modeling assumption in most real-world use cases.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runMetaAnalysis.html">runMetaAnalysis</a></span><span class="op">(</span><span class="va">ma.data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## - Running meta-analyses...</span>
<span class="co">## - [OK] Using Hedges' g as effect size metric... </span>
<span class="co">## - [OK] Calculating overall effect size... DONE</span>
<span class="co">## - [OK] Calculating effect size using only lowest effect... DONE</span>
<span class="co">## - [OK] Calculating effect size using only highest effect... DONE</span>
<span class="co">## - [OK] Calculating effect size using combined effects (rho=0.5)... DONE</span>
<span class="co">## - [OK] Calculating effect size with outliers removed... DONE</span>
<span class="co">## - [OK] Calculating effect size with influential cases removed... DONE</span>
<span class="co">## - [OK] Calculating effect size using only low RoB information... DONE</span>
<span class="co">## - [OK] Calculating effect size using three-level MA model... DONE</span>
<span class="co">## - [OK] Robust variance estimation (RVE) used for three-level MA model... DONE</span>
<span class="co">## - [OK] Calculating effect size using three-level CHE model (rho=0.5)... DONE</span>
<span class="co">## - [OK] Robust variance estimation (RVE) used for three-level CHE model... DONE</span>
<span class="co">## - [OK] Done!</span></code></pre>
<p>We can inspect the results by calling the created <code>res</code>
object in the console. By default, an <strong>HTML table</strong> should
pop up along with the console output. These pre-formatted HTML results
tables can easily be transferred to, for example, MS Word using copy
&amp; paste.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span></code></pre></div>
<pre><code><span class="co">## Model results ------------------------------------------------ </span>
<span class="co">##   model                       k     g g.ci           p         i2 i2.ci      prediction.ci   nnt</span>
<span class="co">## 1 Overall                    28 -0.83 [-1.11; -0.55] &lt;0.001  70.1 [56.08; 7… [-1.89; 0.23]  6.54</span>
<span class="co">## 2 Combined                   13 -0.76 [-1.21; -0.31] 0.003   77.3 [61.5; 86… [-2.06; 0.53]  6.86</span>
<span class="co">## 3 One ES/study (lowest)      13 -0.95 [-1.52; -0.38] 0.003   82.1 [70.54; 8… [-2.73; 0.82]  6.11</span>
<span class="co">## 4 One ES/study (highest)     13 -0.64 [-1.02; -0.26] 0.003   69.5 [45.92; 8… [-1.61; 0.32]  7.64</span>
<span class="co">## 5 Outliers removed           23 -0.74 [-0.86; -0.61] &lt;0.001   0   [0; 45.37] [-0.88; -0.6]  6.99</span>
<span class="co">## 6 Influence Analysis         25 -0.64 [-0.8; -0.49]  &lt;0.001  38.8 [0.97; 62… [-1.18; -0.1…  7.61</span>
<span class="co">## 7 Only rob &gt; 2               10 -0.58 [-0.86; -0.3]  0.001   64.6 [30.37; 8… [-1.37; 0.21]  8.17</span>
<span class="co">## 8 Three-Level Model          28 -0.84 [-1.29; -0.38] 0.002   83.4 -          [-2.35; 0.67]  6.53</span>
<span class="co">## 9 Three-Level Model (CHE)    28 -0.82 [-1.23; -0.4]  0.001   80.2 -          [-2.18; 0.54]  6.6 </span>
<span class="co">## </span>
<span class="co">## Variance components (three-level model) ---------------------- </span>
<span class="co">##                   tau2   i2</span>
<span class="co">## Between Studies 0.4985 83.4</span>
<span class="co">## Within Studies  0.0000  0.0</span>
<span class="co">## Total           0.4985 83.4</span>
<span class="co">## </span>
<span class="co">## Variance components (three-level CHE model) ------------------ </span>
<span class="co">##                   tau2   i2</span>
<span class="co">## Between Studies 0.3368 67.1</span>
<span class="co">## Within Studies  0.0656 13.1</span>
<span class="co">## Total           0.4024 80.2</span></code></pre>
<p>Using the <code>summary</code> method, details of the analysis
settings can be printed. This function also returns recommended
citations for the applied methods and/or packages.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://wviechtb.github.io/metafor/reference/print.rma.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Analysis settings ---------------------------------------------------------- </span>
<span class="co">## </span>
<span class="co">## ✓ [Overall] Random effects model assumed. </span>
<span class="co">## ✓ [Overall] Heterogeneity variance (tau2) calculated using restricted maximum-likelihood estimator. </span>
<span class="co">## ✓ [Overall] Test statistic and CI of the pooled effect calculated using the Knapp-Hartung adjustment. </span>
<span class="co">## ✓ [Outliers removed] ES removed as outliers if the CI did not overlap with pooled effect CI. </span>
<span class="co">## ✓ [Influence Analysis] Influential cases determined using diagnostics of Viechtbauer and Cheung (2010). </span>
<span class="co">## [...]</span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Cite the following packages/methods: ---------------------------------------</span>
<span class="co">## </span>
<span class="co">##  - {meta}: Balduzzi S, Rücker G, Schwarzer G (2019),</span>
<span class="co">##           How to perform a meta-analysis with R: a practical tutorial,</span>
<span class="co">##           Evidence-Based Mental Health; 22: 153-160. </span>
<span class="co">##  - {metafor}: Viechtbauer, W. (2010). Conducting meta-analyses in R</span>
<span class="co">##           with the metafor package. Journal of Statistical Software, 36(3), 1-48.</span>
<span class="co">##           https://doi.org/10.18637/jss.v036.i03. </span>
<span class="co">##  [...]</span></code></pre>
<p>The <code>runMetaAnalysis</code> function allows to tweak many, many
details of the specific meta-analysis models (run
<code><a href="../reference/runMetaAnalysis.html">?runMetaAnalysis</a></code> to see the entire documentation). The most
important arguments one may want to specify are:</p>
<ul>
<li>
<code>es.measure</code>. By default, the function conducts analyses
using the Hedges <span class="math inline">\(g\)</span> values stored in
the data set. To conduct analyses using dichotomous outcome data
(i.e. response, remission, etc.), one has to set this argument to
<code>"RR"</code>.</li>
<li>
<code>es.type</code>. By default, analyses are conducted using the
<code>"precalculated"</code> effect sizes stored in the prepared data
set. For risk ratios, one can alternatively set this argument to
<code>"raw"</code>, which means that the “raw” event counts are used for
computations (instead of the pre-calculated log-risk ratio and its
standard error). This is typically preferable, but may not be possible
if this information could not be extracted from all primary
studies.</li>
<li>
<code>method.tau</code>. This argument controls the method to be
used for estimating the between-study heterogeneity variance <span class="math inline">\(\tau^2\)</span>. The default is
<code>"REML"</code> (restricted maximum likelihood), but other options
such as the DerSimonian-Laird estimator (<code>"DL"</code>) are also
available (see the <code>runMetaAnalysis</code> function documentation
for more details). Note that three-level meta-analysis models can only
be fitted using (restricted) maximum likelihood.</li>
<li>
<code>nnt.cer</code>. The <code>runMetaAnalysis</code> function uses
the method by Furukawa and Leucht to calculate the Number Needed to
Treat (NNT) for each pooled effect size. This method needs an estimate
of the control group event rate (CER). By default,
<code>nnt.cer = 0.2</code> is used, but you can set this to another
value if desired.</li>
<li>
<code>rho.within.study</code>. To combine effect sizes on a study
level before pooling (<code>Combined</code> model), one has to assume a
within-study correlation of effects. By default,
<code>rho.within.study = 0.5</code> is assumed, but this value can and
should be changed based on better approximations. This value also
controls the assumed within-study correlation in the multilevel CHE
mdoel.</li>
<li>
<code>low.rob.filter</code>. By default, the function uses all
comparisons for which the risk of bias rating in the <code>rob</code>
variable has a value greater <code>2</code>
(<code>low.rob.filter = "rob &gt; 2"</code>). If your risk of bias
rating is in another variable, or if another threshold should be used,
you can change this argument accordingly.</li>
</ul>
<p>Here is an example of a <code>runMetaAnalysis</code> call with
non-default settings:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/runMetaAnalysis.html">runMetaAnalysis</a></span><span class="op">(</span><span class="va">data</span>,
                es.measure <span class="op">=</span> <span class="st">"RR"</span>,
                es.type <span class="op">=</span> <span class="st">"raw"</span>,
                method.tau <span class="op">=</span> <span class="st">"DL"</span>,
                nnt.cer <span class="op">=</span> <span class="fl">0.4</span>,
                rho.within.study <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p>It is also possible to directly extract each calculated model from
the <code>runMetaAnalysis</code> results object. Each of these models
are identical to the ones one would receive by running <a href="https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/pooling-es.html#pre-calculated-es" class="external-link"><code>metagen</code></a>
or <a href="https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/multilevel-ma.html#multilevel-R" class="external-link"><code>rma.mv</code></a>
directly.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">model.overall</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.combined</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.lowest</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.highest</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.outliers</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.influence</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.rob</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.threelevel</span>
<span class="va">res</span><span class="op">$</span><span class="va">model.threelevel.che</span></code></pre></div>
<p>This means that <strong>any kind of operation</strong> available for
<code>metagen</code> or <code>rma</code> models <strong>is also
available for the models created by
<code>runMetaAnalysis</code></strong>. For example, we can generate a
funnel plot for our “overall” model like this:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/guido-s/meta/" class="external-link">meta</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/meta/man/funnel.meta.html" class="external-link">funnel</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">model.overall</span>, 
       studlab <span class="op">=</span> <span class="cn">TRUE</span>, 
       contour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span><span class="op">)</span>,
       col.contour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"green"</span>, <span class="st">"lightgreen"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<center>
<p><img src="funnel.png" width="400"></p>
</center>
<p><br></p>
<p>It is also possible to generate <strong>forest plots</strong> of all
the calculated models. We only have to plug the results object into
<code>plot</code>, and specify the name of the model for which the
forest plot should be retrieved:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"overall"</span><span class="op">)</span>        <span class="co"># Overall model (all ES assumed to be independent)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"combined"</span><span class="op">)</span>       <span class="co"># ES combined within studies before pooling</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"lowest.highest"</span><span class="op">)</span> <span class="co"># Lowest and highest ES removed (creates 2 plots)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"outliers"</span><span class="op">)</span>       <span class="co"># Outliers-removed model</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"influence"</span><span class="op">)</span>      <span class="co"># Influential cases-removed model</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"threelevel"</span><span class="op">)</span>     <span class="co"># Three-level model</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"threelevel.che"</span><span class="op">)</span> <span class="co"># Three-level CHE model</span></code></pre></div>
<p>This is what the “overall” model forest plot looks like, for
example:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"overall"</span><span class="op">)</span></code></pre></div>
<center>
<p><img src="forest.png" width="400"></p>
</center>
<p>Note that the <code>plot</code> function is simply a wrapper for the
<code>forest.meta</code> function in the <code>meta</code> package.
Therefore, all the advanced <a href="https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/forest.html" class="external-link">styling
options</a> are also available using extra arguments.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"overall"</span>, 
     col.predict <span class="op">=</span> <span class="st">"lightgreen"</span>, 
     col.square <span class="op">=</span> <span class="st">"lightblue"</span>,
     fontfamily <span class="op">=</span> <span class="st">"Palatino"</span><span class="op">)</span></code></pre></div>
<center>
<p><img src="forest2.png" width="400"></p>
</center>
<p>It is also possible to generate <strong>Baujat</strong> and
<strong>Leave-One-Out Plots</strong> (not displayed here).</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"baujat"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"loo-es"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"loo-i2"</span><span class="op">)</span></code></pre></div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="publication-bias">Publication Bias<a class="anchor" aria-label="anchor" href="#publication-bias"></a>
</h3>
<p>It is also possible to correct effect size estimates for potential
publication bias and/or small-study effects using the <a href="/reference/correctPublicationBias"><code>correctPublicationBias</code></a>
function. This will apply three correction methods at the same time,
providing a range of (more or less) plausible corrected values. Using
the <code>which.run</code> argument, we can apply these methods to the
<code>"combined"</code> analysis.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/correctPublicationBias.html">correctPublicationBias</a></span><span class="op">(</span><span class="va">res</span>,
                       which.run <span class="op">=</span> <span class="st">"combined"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Model results ------------------------------------------------ </span>
<span class="co">## [...]</span>
<span class="co">## </span>
<span class="co">## Publication bias correction ('overall' model) ----------------------- </span>
<span class="co">##   model                    k     g g.ci           p        i2 i2.ci          prediction.ci   nnt</span>
<span class="co">## 1 Trim-and-fill method    17 -0.48 [-1.04; 0.08]  0.090  82.8 [73.54; 88.75] [-2.52; 1.56]  9.4 </span>
<span class="co">## 2 Limit meta-analysis     13  0.12 [-0.48; 0.72]  0.694  96.0 -              [-1.27; 1.51] 28.4 </span>
<span class="co">## 3 Selection model         13 -0.72 [-1.26; -0.19] 0.008  82.2 -              [-1.89; 0.44]  7.08</span>
<span class="co">## </span>
<span class="co">## Variance components (three-level model) ---------------------- </span>
<span class="co">## [...]</span></code></pre>
<p><br></p>
</div>
<div class="section level3">
<h3 id="subgroup-analysis">Subgroup Analysis<a class="anchor" aria-label="anchor" href="#subgroup-analysis"></a>
</h3>
<p>The <code>subgroupAnalysis</code> function can be used to perform
subgroup analyses. Every column included in the data set initially
supplied to <code>runMetaAnalysis</code> can be used as a subgroup
variable.</p>
<p>For example, we might want to check if effects differ by country
(<code>country</code>) or intervention type
(<code>condition_arm1</code>):</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subgroupAnalysis.html">subgroupAnalysis</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">country</span>, <span class="va">arm_format_trt1</span><span class="op">)</span>
<span class="va">sg</span></code></pre></div>
<pre><code><span class="co">## Subgroup analysis results ---------------------- </span>
<span class="co">##   variable       group n.comp     g g.ci              i2 i2.ci        nnt   p    </span>
<span class="co">## 1 country        3          8 -1.12 [-2.33; 0.1]    86.9 [76.3; 92.7] 5.71  0.176</span>
<span class="co">## 2 country        7          2 -0.63 [-1.64; 0.38]    0   -            7.73  0.176</span>
<span class="co">## 3 country        1         18 -0.85 [-1.08; -0.63]  33.7 [0; 62.5]    6.47  0.176</span>
<span class="co">## 4 condition_arm1 cbt       19 -0.81 [-1.18; -0.43]  68.1 [48.7; 80.2] 6.64  0.773</span>
<span class="co">## 5 condition_arm1 pst        9 -0.89 [-1.39; -0.39]  75.9 [53.7; 87.5] 6.32  0.773</span></code></pre>
<p>By default, an HTML table should also pop up. The <code>p</code>
column to the right represents the significance of the overall subgroup
effect (there is, for example, no significant moderator effect of
<code>country</code>).</p>
<p>It is also possible to conduct subgroup analyses using another model,
say, the three-level model. We only have to specify
<code>.which.run</code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subgroupAnalysis.html">subgroupAnalysis</a></span><span class="op">(</span><span class="va">res</span>, 
                       <span class="va">country</span>, <span class="va">condition_arm1</span>,
                       .which.run <span class="op">=</span> <span class="st">"combined"</span><span class="op">)</span></code></pre></div>
<p>When the number of studies in subgroups are small, it is sensible to
use a <strong>common estimate</strong> of the between-study
heterogeneity variance <span class="math inline">\(\tau^2\)</span> (in
lieu of subgroup-specific estimates). This can be done by setting the
<code>.tau.common</code> argument to <code>TRUE</code> in the
function:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subgroupAnalysis.html">subgroupAnalysis</a></span><span class="op">(</span><span class="va">res</span>, 
                       <span class="va">country</span>, <span class="va">condition_arm1</span>,
                       .which.run <span class="op">=</span> <span class="st">"combined"</span>,
                       .tau.common <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><br></p>
</div>
<div class="section level3">
<h3 id="meta-regression">Meta-Regression<a class="anchor" aria-label="anchor" href="#meta-regression"></a>
</h3>
<p>Since the <code>runMetaAnalysis</code> function saves all fitted
models internally, it is also possible to extract each of them
individually to do further computations. Say, for example, that we want
to do a multiple meta-regression using our <code>threelevel</code>
model. We want to use the risk of bias rating, as well as the scaled
study year as predictors. This can be achieved by extracting the model
to be analyzed using the <code>$</code> operator, and then using
<code>metaRegression</code> to fit the model.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/metaRegression.html">metaRegression</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">model.threelevel</span>, 
               <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>Multivariate Meta-Analysis Model (k = 25; method: REML)

Variance Components:

            estim    sqrt  nlvls  fixed       factor 
sigma^2.1  0.4118  0.6417     14     no        study 
sigma^2.2  0.0845  0.2906     25     no  study/es.id 

Test for Residual Heterogeneity:
QE(df = 22) = 85.9318, p-val &lt; .0001

Test of Moderators (coefficients 2:3):
F(df1 = 2, df2 = 22) = 1.6824, p-val = 0.2090

Model Results:

                        estimate      se     tval  df    pval    ci.lb    ci.ub 
intrcpt                  -0.8063  0.1996  -4.0389  22  0.0005  -1.2203  -0.3923  *** 
scale(as.numeric(rob))    0.4249  0.2805   1.5148  22  0.1441  -0.1568   1.0066      
scale(year)              -0.0990  0.2965  -0.3338  22  0.7417  -0.7138   0.5159      

---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</code></pre>
<p><br></p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="study-tables">Study Tables<a class="anchor" aria-label="anchor" href="#study-tables"></a>
</h2>
<hr>
<p>The <code>createStudyTable</code> function allows to create an
overview table for the included studies/comparisons. One only has to
supply the filtered data set first, and then the names of the desired
variables in the order in which they should appear in the table. It is
also possible to rename factor labels directly in the function,
determine how far values should be rounded, and if variable names should
be changed:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/createStudyTable.html">createStudyTable</a></span><span class="op">(</span><span class="va">ma.data</span>,
                 
                 <span class="co">## COLUMNS --------------------------------------</span>
                 <span class="co"># Simply add columns in the order in which</span>
                 <span class="co"># they should appear in the table</span>
                 <span class="va">study</span>, <span class="va">age_group</span>, <span class="va">mean_age_trt1</span>, <span class="va">percent_women_trt1</span>,
                 
                 <span class="co"># You can directly recode values within a variable</span>
                 arm_format_trt1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CBT"</span> <span class="op">=</span> <span class="st">"cbt"</span>, 
                                     <span class="st">"PST"</span> <span class="op">=</span> <span class="st">"pst"</span>,
                                     <span class="st">"BA"</span> <span class="op">=</span> <span class="st">"bat"</span><span class="op">)</span>,
                 arm_format_trt2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Wait-List"</span> <span class="op">=</span> <span class="st">"wl"</span>, 
                                     <span class="st">"Care-As-Usual"</span> <span class="op">=</span> <span class="st">"cau"</span><span class="op">)</span>,
                 <span class="va">n_sessions_trt1</span>, <span class="va">Post_N_trt1</span>, <span class="va">Post_N_trt2</span>, 
                 country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Europe"</span> <span class="op">=</span> <span class="st">"3"</span>, <span class="st">"USA"</span> <span class="op">=</span> <span class="st">"1"</span>,
                             <span class="st">"Asia"</span> <span class="op">=</span> <span class="st">"6"</span>, <span class="st">"Middle East"</span> <span class="op">=</span> <span class="st">"7"</span>, 
                             <span class="st">"Australia"</span> <span class="op">=</span> <span class="st">"5"</span><span class="op">)</span>,
                 <span class="va">sg</span>, <span class="va">ac</span>, <span class="va">ba</span>, <span class="va">itt</span>,
                 
                 
                 <span class="co">## SPECIFICATIONS -------------------------------</span>
                 <span class="co"># .round.by.digits controls the number of rounded digits for</span>
                 <span class="co"># specified columns</span>
                 .round.by.digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean_age_trt1 <span class="op">=</span> <span class="fl">0</span>, 
                                         Post_N_trt1 <span class="op">=</span> <span class="fl">0</span>,
                                         Post_N_trt2 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
                 
                 <span class="co"># .column.names allows to rename columns</span>
                 .column.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="st">"age group"</span>,
                                      mean_age_trt1 <span class="op">=</span> <span class="st">"mean age"</span>,
                                      percent_women_trt1 <span class="op">=</span> <span class="st">"% female"</span>,
                                      arm_format_trt1 <span class="op">=</span> <span class="st">"Intervention"</span>,
                                      arm_format_trt2 <span class="op">=</span> <span class="st">"Control"</span>,
                                      n_sessions_trt1 <span class="op">=</span> <span class="st">"Sessions"</span>,
                                      Post_N_trt1 <span class="op">=</span> <span class="st">"N_ig"</span>, 
                                      Post_N_trt2 <span class="op">=</span> <span class="st">"N_cg"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## - Creating HTML table...</span>
<span class="co">## - [OK] Study table created successfully</span>
<span class="co">## </span>
<span class="co">##                   study age group mean age % female Intervention       Control Sessions ...</span>
<span class="co">## 1         Aagaard, 2017         4       48     0.71          CBT Care-As-Usual        8 ...</span>
<span class="co">## 2  Allart van Dam, 2003         4       46     0.62          CBT Care-As-Usual       12 ...</span>
<span class="co">## 3           Arean, 1993         5       66     0.75          PST     Wait-List       12 ...</span>
<span class="co">## 4            Ayen, 2004         4       51     1.00          CBT     Wait-List       12 ...</span>
<span class="co">## 5         Barrera, 1979         4       36     0.50           BA     Wait-List        8 ...</span>
<span class="co">## 6           Beach, 1992         4       39     1.00          CBT     Wait-List       18 ...</span>
<span class="co">## 7      Boeschoten, 2017         4       49     0.80          PST     Wait-List        5 ...</span>
<span class="co">## 8          Bowman, 1995         4       36     0.63          CBT     Wait-List        4 ...</span>
<span class="co">## 9          Bowman, 1995         4       36     0.63          PST     Wait-List        4 ...</span>
<span class="co">## 10          Brown, 1984         4       36     0.70          CBT     Wait-List       12 ...</span>
<span class="co">## 11          Brown, 1984         4       36     0.70          CBT     Wait-List       12 ...</span>
<span class="co">## 12          Brown, 1984         4       36     0.70          CBT     Wait-List       12 ...</span>
<span class="co">## 13          Carta, 2012         4       42     0.66          CBT Care-As-Usual       12 ...</span>
<span class="co">## 14        Casanas, 2012         4       53     0.89          CBT Care-As-Usual        9 ...</span>
<span class="co">## 15        Casanas, 2012         4       53     0.89          CBT Care-As-Usual        9 ...</span>
<span class="co">## 16     Castonguay, 2004         4       39     0.75          CBT     Wait-List       16 ...</span>
<span class="co">## 17     Castonguay, 2004         4       39     0.75          CBT     Wait-List       16 ...</span>
<span class="co">## 18            Cho, 2008         4       30     1.00          CBT Care-As-Usual        9 ...</span>
<span class="co">## 19            Cho, 2008         4       30     1.00          CBT Care-As-Usual        9 ...</span>
<span class="co">## 20           Choi, 2012         4       39     0.80          CBT     Wait-List        6 ...</span>
<span class="co">## 21      Chowdhary, 2016         4       41     0.69           BA Care-As-Usual        7 ...</span>
<span class="co">## 22      Chowdhary, 2016         4       41     0.69           BA Care-As-Usual        7 ...</span></code></pre>
<p>By default, <code>createStudyTable</code> also returns an HTML table
that one can copy &amp; paste in MS Word.</p>
<p><br></p>
<div style="border: 1px solid #dee2e6; background-color: #f1f3f5 !important; padding: 10px; border-radius: 3px;">
<p><strong>Still have questions?</strong> This vignette only provides a
superficial overview of <code>metapsyTools</code>’ functionality. Every
function also comes with a detailed documentation, which you may consult
to learn more about available options and covered use cases. Please note
that <code>metapsyTools</code> is still at an early development stage,
which means that errors or other problems may still occur under some
circumstances. To report an issue or ask for help, you can contact
<strong>Mathias</strong> (<a href="mailto:mathias.harrer@tum.de" class="email">mathias.harrer@tum.de</a>).</p>
</div>
<p><br></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mathias Harrer, Paula Kuper, Antonia Sprenger, Pim
Cuijpers.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
</div>

    </footer>
</div>

  

  <script src="extra_script.js"></script>
</body>
</html>
